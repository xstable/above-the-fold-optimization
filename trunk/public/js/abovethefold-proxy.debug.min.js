!function(d){function y(a){var b=K(a);if(b){var c;a:{c=m("css"===b?a.href:a.src).href;var e,f=!1;if(z){var g=A.indexOf(c);if(-1<g)var h=B[g];else if(0<n.length)for(var l,k=n.length,p=0;p<k;p++){g=!1;try{l=new RegExp(n[p][0],n[p][1]||"")}catch(N){g=!0}if(!g&&l.test(c)){f=!0;e=c;n[p][2]?h=n[p][2]:n[p][3]&&(c=n[p][3]);break}}if(h){l=void 0!==t[c]?t[c]:C;l+=h.substr(0,2)+"/";l+=h.substr(2,2)+"/";l+=h.substr(4,2)+"/";l+=h;g=!1;if("js"===b){if(l+=".js",void 0!==d.csu)k=m(l).href,(l=d.csu(k))!==k&&(g=l)}else"css"===
b&&(l+=".css");c=(g?f?console.log("Abtf.proxy()","localStorage regex capture",d.localUrl(e),"\u27a4","cache:"+h,"\u27a4",g):console.log("Abtf.proxy()","localStorage capture",d.localUrl(c),"\u27a4","cache:"+h,"\u27a4",g):f?console.log("Abtf.proxy()","regex capture",d.localUrl(e),"\u27a4","cache:"+h):console.log("Abtf.proxy()","capture",d.localUrl(c),"\u27a4","cache:"+h),l);break a}}if("js"===b&&void 0!==d.csu&&(h=m(c).href,(c=d.csu(h))!==h)){c=(f?console.log("Abtf.proxy()","localStorage regex capture",
d.localUrl(e),"regex","\u27a4",d.localUrl(h),"\u27a4",c):console.log("Abtf.proxy()","localStorage capture",d.localUrl(h),"\u27a4",c),c);break a}c=(f?console.log("Abtf.proxy()","capture",d.localUrl(e),"regex","\u27a4",c):console.log("Abtf.proxy()","capture",d.localUrl(c)),D(c,b))}"css"===b?a.href=c:"js"===b&&(a.src=c)}}function K(a){if(a.nodeName)if("SCRIPT"===a.nodeName.toUpperCase()){if(!E)return!1;if("abtf"===a.getAttribute("rel"))return a.removeAttribute("rel"),!1;if(a.src){b=m(a.src);if(L(b))return!1;
if(!F(b)){if(void 0!==d.csu){if("blob:"===b.protocol)return!1;url=d.csu(b.href);url!==b.href?(console.log("Abtf.proxy()","localStorage local capture",d.localUrl(b.href),"\u27a4",url),a.src=url):console.log("Abtf.proxy()","localStorage local capture",d.localUrl(b.href),"\u27a4","bypass cache","\u27a4",url)}return!1}return"js"}}else if("LINK"===a.nodeName.toUpperCase()&&"stylesheet"===a.rel.toLowerCase()){if(!G)return!1;if("abtf"===a.getAttribute("rel"))return a.removeAttribute("rel"),!1;if(a.href){var b=
m(a.href);if(a=!M(b)){a:if(b="object"==typeof b&&void 0!==b.href?b:m(b),"blob:"===b.protocol)b=!1;else{if(f){a=f.length;for(var c=0;c<a;c++)if(-1!==b.href.indexOf(f[c].href)){b=!1;break a}}b=b.host!==w.host}a=!!b&&"css"}return a}}return!1}function M(a){a="object"==typeof a&&void 0!==a.href?a:m(a);if("blob:"===a.protocol)return!0;if(u){for(var b=!1,c=u.length,e=0;e<c;e++)if(-1!==a.href.indexOf(u[e])){b=!0;break}if(!b)return console.log("Abtf.proxy()","ignore",d.localUrl(a.href),"not on include list"),
!0}if(q)for(c=q.length,e=0;e<c;e++)if(-1!==a.href.indexOf(q[e]))return console.log("Abtf.proxy()","ignore",d.localUrl(a.href),"on exclude list:",q[e]),!0;return!1}function L(a){a="object"==typeof a&&void 0!==a.href?a:m(a);if("blob:"===a.protocol)return!0;if(v){for(var b=!1,c=v.length,e=0;e<c;e++)if(-1!==a.href.indexOf(v[e])){b=!0;break}if(!b)return console.log("Abtf.proxy()","ignore",d.localUrl(a.href),"not on include list"),!0}if(r)for(c=r.length,e=0;e<c;e++)if(-1!==a.href.indexOf(r[e]))return console.log("Abtf.proxy()",
"ignore",d.localUrl(a.href),"on exclude list:",r[e]),!0;return!1}function F(a,b){var c="object"==typeof a&&void 0!==a.href?a:m(a);if("blob:"===c.protocol)return!1;if(f&&!0!==b)for(var e=f.length,d=0;d<e;d++)if(-1!==c.href.indexOf(f[d].href))return!1;return c.host!==w.host}function D(a,b){return"css"===b?x.replace("{PROXY:URL}",escape(a)).replace("{PROXY:TYPE}",escape(b)):"js"===b?x.replace("{PROXY:URL}",escape(a)).replace("{PROXY:TYPE}",escape(b)):void 0}function m(a){var b=document.createElement("a");
return b.href=a,b}var x,C,E=!1,G=!1,H=!1,v=!1,r=!1,u=!1,q=!1,z=!1,A=[],B=[],n=[],t={},f=[];d.ps=function(a){if(void 0===b)var b=!1;if((x=a.url||b)||console.error("Abtf.proxy()","no proxy url",a),E=a.js||!1,G=a.css||!1,(H=a.cdn||!1)&&f.push(H),v=a.js_include||!1,r=a.js_exclude||!1,u=a.css_include||!1,q=a.css_exclude||!1,a.preload){z=!0;for(b=0;b<a.preload.length;b++)"regex"===a.preload[b][0]?(n.push([a.preload[b][2],a.preload[b][3],a.preload[b][1]]),a.preload[b][4]&&(t[a.preload[b][0]]=a.preload[b][4],
-1===f.indexOf(a.preload[b][4])&&f.push(a.preload[b][4]))):(A.push(a.preload[b][0]),B.push(a.preload[b][1]),a.preload[b][4]&&(t[a.preload[b][0]]=a.preload[b][4],-1===f.indexOf(a.preload[b][4])&&f.push(a.preload[b][4])));C=a.base||!1}if(0===f.length)f=!1;else for(a=f.length,b=0;b<a;b++)f[b]=m(f[b])};var k={Element:"undefined"!=typeof Element&&Element,Document:"undefined"!=typeof Document&&Document},I={},J={},g;for(g in k)k.hasOwnProperty(g)&&k[g]&&(I[g]=k[g].prototype.appendChild,J[g]=k[g].prototype.insertBefore);
var w=document.createElement("a");w.href=document.location.href;for(g in k)k.hasOwnProperty(g)&&k[g]&&function(a){k[a].prototype.appendChild=function(b){return y(b),I[a].call(this,b)};k[a].prototype.insertBefore=function(b,c){return y(b),J[a].call(this,b,c)}}(g);d.pxs=function(a){return F(a,!0)?D(a,"js"):a}}(window.Abtf);
